import pygame
import random
import sys
from pygame.locals import *

# Инициализация Pygame
pygame.init()

# Настройки экрана (адаптивность для ПК и телефона)
WIDTH, HEIGHT = 800, 600
screen = pygame.display.set_mode((WIDTH, HEIGHT), pygame.RESIZABLE)
pygame.display.set_caption("Симулятор Психиатра")

# Цвета
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)
GRAY = (200, 200, 200)
RED = (255, 0, 0)
GREEN = (0, 255, 0)
BLUE = (0, 0, 255)
YELLOW = (255, 255, 0)

# Шрифты
font_small = pygame.font.SysFont('Arial', 16)
font_medium = pygame.font.SysFont('Arial', 24)
font_large = pygame.font.SysFont('Arial', 32)

# Состояния игры
STATE_MENU = 0
STATE_RECEPTION = 1
STATE_DIAGNOSIS = 2
STATE_TREATMENT = 3
STATE_XRAY = 4

current_state = STATE_MENU
current_patient = None
money = 0
day = 1
patients_treated = 0

# Генерация случайного пациента
def generate_patient():
    names = ["Иван", "Алексей", "Мария", "Ольга", "Дмитрий", "Сергей", "Анна"]
    symptoms = [
        "Галлюцинации",
        "Бред",
        "Дезорганизованная речь",
        "Кататония",
        "Негативные симптомы",
        "Паранойя",
        "Слуховые голоса"
    ]
    treatments = {
        "Галлюцинации": ["Арипипразол", "Рисперидон"],
        "Бред": ["Оланзапин", "Кветиапин"],
        "Дезорганизованная речь": ["Галоперидол", "Зипрасидон"],
        "Кататония": ["Лоразепам", "ЭСТ"],
        "Негативные симптомы": ["Амисульприд", "Карпипрамин"],
        "Паранойя": ["Трифлуоперазин", "Перфеназин"],
        "Слуховые голоса": ["Клозапин", "Палиперидон"]
    }

    name = random.choice(names)
    age = random.randint(18, 70)
    symptom = random.choice(symptoms)
    correct_treatment = random.choice(treatments[symptom])
    severity = random.randint(1, 5)

    return {
        "name": name,
        "age": age,
        "symptom": symptom,
        "correct_treatment": correct_treatment,
        "severity": severity,
        "treated": False
    }

# Основной игровой цикл
clock = pygame.time.Clock()
running = True

while running:
    screen.fill(WHITE)

    # Обработка событий
    for event in pygame.event.get():
        if event.type == QUIT:
            running = False
        elif event.type == VIDEORESIZE:
            WIDTH, HEIGHT = event.size
            screen = pygame.display.set_mode((WIDTH, HEIGHT), pygame.RESIZABLE)
        elif event.type == MOUSEBUTTONDOWN:
            mouse_pos = pygame.mouse.get_pos()

            # Обработка кликов в меню
            if current_state == STATE_MENU:
                if (WIDTH // 2 - 100 <= mouse_pos[0] <= WIDTH // 2 + 100 and
                    HEIGHT // 2 - 25 <= mouse_pos[1] <= HEIGHT // 2 + 25):
                    current_state = STATE_RECEPTION
                    current_patient = generate_patient()

            # Обработка кликов в приемной
            elif current_state == STATE_RECEPTION:
                if (50 <= mouse_pos[0] <= 250 and 500 <= mouse_pos[1] <= 550):
                    current_state = STATE_DIAGNOSIS
                elif (550 <= mouse_pos[0] <= 750 and 500 <= mouse_pos[1] <= 550):
                    current_patient = generate_patient()

            # Обработка кликов в диагностике
            elif current_state == STATE_DIAGNOSIS:
                if (50 <= mouse_pos[0] <= 250 and 500 <= mouse_pos[1] <= 550):
                    current_state = STATE_XRAY
                elif (300 <= mouse_pos[0] <= 500 and 500 <= mouse_pos[1] <= 550):
                    current_state = STATE_TREATMENT
                elif (550 <= mouse_pos[0] <= 750 and 500 <= mouse_pos[1] <= 550):
                    current_state = STATE_RECEPTION

            # Обработка кликов в лечении
            elif current_state == STATE_TREATMENT:
                button_width = 200
                for i, treatment in enumerate(["Арипипразол", "Рисперидон", "Оланзапин", "Кветиапин", "Галоперидол", "Зипрасидон"]):
                    x = (i % 3) * (button_width + 20) + 50
                    y = (i // 3) * 60 + 200
                    if (x <= mouse_pos[0] <= x + button_width and y <= mouse_pos[1] <= y + 50):
                        if treatment == current_patient["correct_treatment"]:
                            money += current_patient["severity"] * 100
                            patients_treated += 1
                            current_patient["treated"] = True
                        else:
                            money -= 50
                        current_state = STATE_RECEPTION
                        current_patient = generate_patient()

            # Обработка кликов в рентгене
            elif current_state == STATE_XRAY:
                if (50 <= mouse_pos[0] <= 250 and 500 <= mouse_pos[1] <= 550):
                    current_state = STATE_DIAGNOSIS
                elif (550 <= mouse_pos[0] <= 750 and 500 <= mouse_pos[1] <= 550):
                    current_state = STATE_RECEPTION

    # Отрисовка в зависимости от состояния
    if current_state == STATE_MENU:
        title = font_large.render("Симулятор Психиатра", True, BLUE)
        screen.blit(title, (WIDTH // 2 - title.get_width() // 2, 100))

        pygame.draw.rect(screen, GREEN, (WIDTH // 2 - 100, HEIGHT // 2 - 25, 200, 50))
        start_text = font_medium.render("Начать игру", True, BLACK)
        screen.blit(start_text, (WIDTH // 2 - start_text.get_width() // 2, HEIGHT // 2 - start_text.get_height() // 2))

    elif current_state == STATE_RECEPTION:
        # Отрисовка информации о пациенте
        patient_info = [
            f"Пациент: {current_patient['name']}",
            f"Возраст: {current_patient['age']}",
            f"Симптом: {current_patient['symptom']}",
            f"Тяжесть: {'★' * current_patient['severity']}"
        ]

        for i, line in enumerate(patient_info):
            text = font_medium.render(line, True, BLUE if i == 2 else BLACK)
            screen.blit(text, (50, 100 + i * 40))

        # Кнопки действий
        pygame.draw.rect(screen, GREEN, (50, 500, 200, 50))
        diagnose_text = font_medium.render("Диагностика", True, BLACK)
        screen.blit(diagnose_text, (50 + 100 - diagnose_text.get_width() // 2, 525 - diagnose_text.get_height() // 2))

        pygame.draw.rect(screen, YELLOW, (550, 500, 200, 50))
        next_text = font_medium.render("Следующий", True, BLACK)
        screen.blit(next_text, (550 + 100 - next_text.get_width() // 2, 525 - next_text.get_height() // 2))

    elif current_state == STATE_DIAGNOSIS:
        # Отрисовка информации о диагностике
        diagnosis_info = [
            f"Диагноз: Шизофрения",
            f"Тип: {current_patient['symptom']}",
            f"Рекомендации: {current_patient['correct_treatment']} (но вы не знаете)"
        ]

        for i, line in enumerate(diagnosis_info):
            text = font_medium.render(line, True, BLUE if i == 1 else BLACK)
            screen.blit(text, (50, 100 + i * 40))

        # Кнопки действий
        pygame.draw.rect(screen, GREEN, (50, 500, 200, 50))
        xray_text = font_medium.render("Рентген", True, BLACK)
        screen.blit(xray_text, (50 + 100 - xray_text.get_width() // 2, 525 - xray_text.get_height() // 2))

        pygame.draw.rect(screen, YELLOW, (300, 500, 200, 50))
        treat_text = font_medium.render("Лечение", True, BLACK)
        screen.blit(treat_text, (300 + 100 - treat_text.get_width() // 2, 525 - treat_text.get_height() // 2))

        pygame.draw.rect(screen, RED, (550, 500, 200, 50))
        back_text = font_medium.render("Назад", True, BLACK)
        screen.blit(back_text, (550 + 100 - back_text.get_width() // 2, 525 - back_text.get_height() // 2))

    elif current_state == STATE_TREATMENT:
        # Отрисовка информации о лечении
        treat_info = font_large.render("Выберите лечение:", True, BLUE)
        screen.blit(treat_info, (50, 150))

        # Кнопки лекарств
        medications = ["Арипипразол", "Рисперидон", "Оланзапин", "Кветиапин", "Галоперидол", "Зипрасидон"]
        button_width = 200
        for i, med in enumerate(medications):
            x = (i % 3) * (button_width + 20) + 50
            y = (i // 3) * 60 + 200
            pygame.draw.rect(screen, GRAY, (x, y, button_width, 50))
            med_text = font_medium.render(med, True, BLUE if med == current_patient["correct_treatment"] else BLACK)
            screen.blit(med_text, (x + button_width // 2 - med_text.get_width() // 2, y + 25 - med_text.get_height() // 2))

    elif current_state == STATE_XRAY:
        # Отрисовка "рентгена" (просто картинка)
        pygame.draw.ellipse(screen, GRAY, (WIDTH // 2 - 150, 150, 300, 300))
        for _ in range(20):
            x = random.randint(WIDTH // 2 - 140, WIDTH // 2 + 140)
            y = random.randint(160, 440)
            pygame.draw.circle(screen, RED if random.random() > 0.8 else BLUE, (x, y), random.randint(2, 5))

        xray_text = font_large.render("Рентген головного мозга", True, BLUE)
        screen.blit(xray_text, (WIDTH // 2 - xray_text.get_width() // 2, 50))

        # Кнопки действий
        pygame.draw.rect(screen, GREEN, (50, 500, 200, 50))
        back_text = font_medium.render("Назад", True, BLACK)
        screen.blit(back_text, (50 + 100 - back_text.get_width() // 2, 525 - back_text.get_height() // 2))

        pygame.draw.rect(screen, YELLOW, (550, 500, 200, 50))
        next_text = font_medium.render("Готово", True, BLACK)
        screen.blit(next_text, (550 + 100 - next_text.get_width() // 2, 525 - next_text.get_height() // 2))

    # Отрисовка общей информации (день, деньги, пациенты)
    info_text = [
        f"День: {day}",
        f"Деньги: ${money}",
        f"Пациентов: {patients_treated}"
    ]

    for i, line in enumerate(info_text):
        text = font_small.render(line, True, BLUE if i == 1 else BLACK)
        screen.blit(text, (WIDTH - 150, 20 + i * 20))

    pygame.display.flip()
    clock.tick(30)

pygame.quit()
sys.exit()
